WITH DataSource AS
(
  SELECT
    '0174' AS InterfaceId,
    '0' AS ErrorClassification,
    CASE WHEN ISNULL(OrderSource, '') = '' THEN OrderSource
         ELSE CONCAT(SUBSTRING(OrderSource, 1, 2), SUBSTRING(CONVERT(VARCHAR(10), IF0174Seq), 3, 8))
    END AS OhiId,
    '0' AS Status,
    CASE WHEN ISNULL(OrderSource, '') = '' THEN OrderSource
         ELSE CONCAT(SUBSTRING(OrderSource, 1, 3), IF0174Seq)
    END AS OrigSysDocumentRef,
    CONVERT(INT, NULLIF(OrderSource, '')) AS OrderSource,
    CustomerPoNumber,
    CustomerNumber,
    ShipmentPriorityCode,
    ShipToOrgCode,
    OrganizationCode,
    SecondaryInventoryName,
    CASE WHEN ISNULL(OrderSource, '') = '' THEN OrderSource
         ELSE CONCAT(SUBSTRING(OrderSource, 1, 2), SUBSTRING(CONVERT(VARCHAR(10), IF0174Seq), 3, 8))
    END AS OliId,
    OrigSysLineRef,
    InventoryItemSegment1,
    OrderedQuantity,
    InvoiceToOrgCode,
    '' As ErrorMessage,
    '' AS SalesTableOIFRecId
  FROM earth_dp_SpoonsOrderIF_LS_IF_0174_TempWithSeq
)
SELECT
  CustomerNumber,
  CustomerPoNumber,
  ErrorClassification,
  ErrorMessage,
  InterfaceId,
  InventoryItemSegment1,
  InvoiceToOrgCode,
  MAX(OhiId) AS OhiId,
  MAX(OliId) AS OliId,
  OrderSource,
  OrderedQuantity,
  OrganizationCode,
  MAX(OrigSysDocumentRef) AS OrigSysDocumentRef,
  OrigSysLineRef,
  MAX(SecondaryInventoryName) AS SecondaryInventoryName,
  MAX(ShipToOrgCode) AS ShipToOrgCode,
  MAX(ShipmentPriorityCode) AS ShipmentPriorityCode,
  '' AS SalesTableOIFRecId,
  MAX(Status) AS Status
FROM DataSource
GROUP BY CustomerNumber, CustomerPoNumber, ErrorClassification, ErrorMessage, InterfaceId, InventoryItemSegment1, InvoiceToOrgCode, OrderSource, OrderedQuantity, OrigSysLineRef;
