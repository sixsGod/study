WITH DataSource AS
(
  SELECT
    '0174' AS InterfaceId,
    '0' AS ErrorClassification,
    MAX(IIF(
      ISNULL(OrderSource, ''),
      OrderSource,
      CONCAT(SUBSTRING(OrderSource, 1, 2), SUBSTRING(CONVERT(VARCHAR(10), IF0174Seq), 3, 8))
    )) AS OhiId,
    '0' AS Status,
    MAX(IIF(
      ISNULL(OrderSource, ''),
      OrderSource,
      CONCAT(SUBSTRING(OrderSource, 1, 3), IF0174Seq)
    )) AS OrigSysDocumentRef,
    CONVERT(INT, NULLIF(OrderSource, '')) AS OrderSource,
    CustomerPoNumber,
    CustomerNumber,
    ShipmentPriorityCode,
    ShipToOrgCode,
    OrganizationCode,
    SecondaryInventoryName,
    MAX(IIF(
      ISNULL(OrderSource, ''),
      OrderSource,
      CONCAT(SUBSTRING(OrderSource, 1, 2), SUBSTRING(CONVERT(VARCHAR(10), IF0174Seq), 3, 8))
    )) AS OliId,
    OrigSysLineRef,
    InventoryItemSegment1,
    OrderedQuantity,
    InvoiceToOrgCode,
    '' As ErrorMessage,
    '' AS SalesTableOIFRecId
  FROM earth_dp_SpoonsOrderIF_LS_IF_0174_TempWithSeq
  GROUP BY OrderSource, CustomerPoNumber, CustomerNumber, ShipmentPriorityCode, ShipToOrgCode, OrganizationCode, OrigSysLineRef, InventoryItemSegment1, OrderedQuantity, InvoiceToOrgCode
)
SELECT
  CustomerNumber,
  CustomerPoNumber,
  ErrorClassification,
  ErrorMessage,
  InterfaceId,
  InventoryItemSegment1,
  InvoiceToOrgCode,
  OhiId,
  OliId,
  OrderSource,
  OrderedQuantity,
  OrganizationCode,
  OrigSysDocumentRef,
  OrigSysLineRef,
  SecondaryInventoryName,
  ShipToOrgCode,
  ShipmentPriorityCode,
  '' AS SalesTableOIFRecId,
  Status
FROM DataSource;
