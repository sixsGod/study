ALTER PROCEDURE UpdateOhiIdBasedOnOrderSourceAndCustomerPoNumber
AS
BEGIN
    DECLARE @OrderSource VARCHAR(255);
    DECLARE @CustomerPoNumber VARCHAR(255);
    DECLARE @OhiIdToUpdate VARCHAR(255);
    DECLARE @PreviousOhiId VARCHAR(255);

    DECLARE cur CURSOR FOR
    SELECT OrderSource, CustomerPoNumber, OhiId
    FROM YourTableName
    WHERE OrderSource IS NOT NULL AND CustomerPoNumber IS NOT NULL
    ORDER BY OrderSource, CustomerPoNumber;

    OPEN cur;

    FETCH NEXT FROM cur INTO @OrderSource, @CustomerPoNumber, @OhiIdToUpdate;

    SET @PreviousOhiId = NULL;

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- 输出当前记录的信息以进行调试
        PRINT 'Current Record: OrderSource=' + @OrderSource + ', CustomerPoNumber=' + @CustomerPoNumber + ', OhiIdToUpdate=' + @OhiIdToUpdate + ', PreviousOhiId=' + ISNULL(@PreviousOhiId, 'NULL');

        IF @PreviousOhiId IS NOT NULL
        BEGIN
            UPDATE YourTableName
            SET OhiId = @PreviousOhiId
            WHERE CURRENT OF cur;
        END

        SET @PreviousOhiId = @OhiIdToUpdate;

        FETCH NEXT FROM cur INTO @OrderSource, @CustomerPoNumber, @OhiIdToUpdate;
    END

    CLOSE cur;
    DEALLOCATE cur;
END;
