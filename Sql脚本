CREATE PROCEDURE UpdateOhiIdBasedOnOrderSourceAndCustomerPoNumber
AS
BEGIN
    -- 使用游标循环遍历表中的记录
    DECLARE @OrderSource VARCHAR(255);
    DECLARE @CustomerPoNumber VARCHAR(255);
    DECLARE @OhiIdToUpdate VARCHAR(255);

    DECLARE cur CURSOR FOR
    SELECT OrderSource, CustomerPoNumber, OhiId
    FROM YourTableName
    WHERE OrderSource IS NOT NULL AND CustomerPoNumber IS NOT NULL;

    OPEN cur;

    FETCH NEXT FROM cur INTO @OrderSource, @CustomerPoNumber, @OhiIdToUpdate;

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- 检查是否存在相同 OrderSource 和 CustomerPoNumber 的记录
        IF EXISTS (
            SELECT 1
            FROM YourTableName
            WHERE OrderSource = @OrderSource AND CustomerPoNumber = @CustomerPoNumber AND OhiId != @OhiIdToUpdate
        )
        BEGIN
            -- 如果存在相同的记录，则更新另一条记录的 OhiId 为当前记录的 OhiId
            UPDATE YourTableName
            SET OhiId = @OhiIdToUpdate
            WHERE OrderSource = @OrderSource AND CustomerPoNumber = @CustomerPoNumber AND OhiId != @OhiIdToUpdate;
        END

        FETCH NEXT FROM cur INTO @OrderSource, @CustomerPoNumber, @OhiIdToUpdate;
    END

    CLOSE cur;
    DEALLOCATE cur;
END;
