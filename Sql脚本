WITH CTE AS (
    SELECT *,
           LAG(OhiId) OVER (ORDER BY SomeColumn) AS PreviousOhiId,
           LAG(OrderSource) OVER (ORDER BY SomeColumn) AS PreviousOrderSource,
           LAG(CustomerPoNumber) OVER (ORDER BY SomeColumn) AS PreviousCustomerPoNumber
    FROM earth_dp_SpoonsOrderIF_LS_IF_0174_TempWithSeq
)
UPDATE CTE
SET IF0174Seq = CASE WHEN PreviousOrderSource = OrderSource AND PreviousCustomerPoNumber = CustomerPoNumber THEN PreviousOhiId ELSE IF0174Seq END;

